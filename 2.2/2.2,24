Accion 
AMBIENTE

	FECHA = REGISTRO
		AA: N (4);
		MM: 1..12;
		DD: 1..31;
	FR;

	CPA = REGISTRO
		COD_AFIL: N (5); 
		FECHA_ALTA: FECHA;
		FECHA_BAJA: FECHA;
		CANT_SERV: N (2);
		COSTO: N;
	FR;

	SERSEM = REGISTRO
		COD_AFIL: N (5);
		FECHA_AT: FECHA;
		COD_SERV: N;
		COSTO: N;
	FR;

PROCESO

	ABRIR E / (AMAE); ABRIR E / (AMOV); ABRIR / S (ASAL);
	LEER_MAE; LEER_MOV;
	CONSER: = 0; CONCAST: = 0;
	
	MIENTRAS ((RMA.COD_AFIL <> HV) v (RMOV.COD_AFIL <> HV)) HACER
		SI RMAE.COD_AFIL> RMOV.COD_AFIL ENTONCES
			SI RMOV.COD_SER = 001 ENTONCES
				RSAL.COD_AFIL: = RMOV.COD_AFIL;
				RSAL.FECHA_ALTA: = RMOV.FECHA_AT;
				COSTO RSAL: = RMOV.COSTO;
				ESCRIBIR (ASAL, RSAL);
			SINO
				ESCRIBIR ("ERROR ALTA");
			FS;
			LEER_MOV;
		SINO
			SI RMAE.COD_AFIL = RMOV.COD_AFIL ENTONCES

				MIENTRAS RMOV.COD_AFIL = RMAE.COD_AFIL HACER
					SI RMOV.COD_SERV = 000 ENTONCES
						RSAL: = RMAE;
						RSAL.FECHA_BAJA: = RMOV.FECHA_AT;		
					SINO
						CONTSER: = CONTSER + 1;
						COSTO: = COSTO + RMOV.COSTO;
						RSAL: = RMAE;
						RSAL.CANT_SERV: = RSAL.CANT_SERV + CONTSER;
						RSAL.COSTO: = RSAL.COSTO + CONCOST;
					FS;
					LEER_MOV;
				FM;
				ESCRIBIR (ASAL, RSAL);
				LEER_MAE;
			SINO 
				SI RMAE.COD_AFIL <RMOV.COD_AFIL ENTONCES
					RSAL: = RMAE;
					ESCRIBIR (ASAL, RSAL);
					LEER_MAE;
				FS
                AMBIENTE
PROCESO

	ABRIR E / (AMAE); 

SINO
			SI RMAE.COD_AFIL = RMOV.COD_AFIL ENTONCES

SINO
						CONTSER: = CONTSER + 1;
						COSTO: = COSTO + RMOV.COSTO;
						RSAL: = RMAE;
						RSAL.CANT_SERV: = RSAL.CANT_SERV + CONTSER;
						RSAL.COSTO: = RSAL.COSTO + CONCOST;
					FS;
					LEER_MOV;
				FM;
				ESCRIBIR (ASAL, RSAL);
				LEER_MAE;
SINO 
				SI RMAE.COD_AFIL <RMOV.COD_AFIL ENTONCES
					RSAL: = RMAE;
					ESCRIBIR (ASAL, RSAL);
					LEER_MAE;
				FS;
			FS;
		FS;
	FM;
	CERRAR (AMAE); CERRAR (ASAL); CERRAR (AMOV);
Fin_Accion.

